From 91d684bd9fa07826d0c890bf518ffd0f5979197d Mon Sep 17 00:00:00 2001
From: niqiang <niqiang@uniontech.com>
Date: Fri, 29 May 2020 20:36:53 +0800
Subject: [PATCH 23/29] =?UTF-8?q?=E5=A2=9E=E5=8A=A0=E5=8A=9F=E8=83=BD?=
 =?UTF-8?q?=E4=BB=A3=E7=A0=81=E5=AE=9A=E4=BD=8D=E7=B2=BE=E5=BA=A6=EF=BC=8C?=
 =?UTF-8?q?=E7=BC=A9=E5=B0=8F=E4=BF=AE=E6=94=B9=E4=BB=A3=E7=A0=81=E5=BD=B1?=
 =?UTF-8?q?=E5=93=8D=E8=8C=83=E5=9B=B4?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 ...deepin-fcitx-icon-change-to-keyboard.patch | 24 ++++++++++---------
 1 file changed, 13 insertions(+), 11 deletions(-)

diff --git a/debian/patches/deepin-fcitx-icon-change-to-keyboard.patch b/debian/patches/deepin-fcitx-icon-change-to-keyboard.patch
index b5563fb..4f7a8f8 100644
--- a/debian/patches/deepin-fcitx-icon-change-to-keyboard.patch
+++ b/debian/patches/deepin-fcitx-icon-change-to-keyboard.patch
@@ -1,18 +1,20 @@
-Description: 修复鼠标移到，任务栏输入法图标上时，图标样式改变问题
+Description: 修复鼠标移到任务栏输入法图标上时，图标样式改变问题。本身该问题与fcitx无关，系统改变了输入框的焦点状态，为了解决问题屏蔽了丢失焦点后的hook处理。
 Bug:	     https://pms.uniontech.com/zentao/task-view-22252.html
 Author:	     niqiang
 Reviewed-By: huxiaodong
 Last-Update: 2020-05-20
 
-Index: fcitx-4.2.9.19/src/lib/fcitx/ui.c
+Index: fcitx-4.2.9.19/src/module/notificationitem/notificationitem.c
 ===================================================================
---- fcitx-4.2.9.19.orig/src/lib/fcitx/ui.c
-+++ fcitx-4.2.9.19/src/lib/fcitx/ui.c
-@@ -691,6 +691,7 @@ void FcitxUIOnInputFocus(FcitxInstance*
- FCITX_EXPORT_API
- void FcitxUIOnInputUnFocus(struct _FcitxInstance* instance)
- {
-+    return;
-     if (UI_FUNC_IS_VALID(OnInputUnFocus))
-         instance->ui->ui->OnInputUnFocus(instance->ui->addonInstance);
+--- fcitx-4.2.9.19.orig/src/module/notificationitem/notificationitem.c
++++ fcitx-4.2.9.19/src/module/notificationitem/notificationitem.c
+@@ -236,7 +236,9 @@ void* FcitxNotificationItemCreate(FcitxI
+         hk.func = FcitxNotificationItemIMChanged;
+         FcitxInstanceRegisterIMChangedHook(instance, hk);
+         FcitxInstanceRegisterInputFocusHook(instance, hk);
++#if 0
+         FcitxInstanceRegisterInputUnFocusHook(instance, hk);
++#endif
  
+         hk.func = FcitxNotificationItemUpdateIMList;
+         FcitxInstanceRegisterUpdateIMListHook(instance, hk);
-- 
2.20.1

